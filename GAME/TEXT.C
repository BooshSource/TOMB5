#include "TEXT.H"

#if PC_VERSION
#include "GLOBAL.H"
#include "INCLUDE.H"
#elif PSX_VERSION || PSXPC_VERSION || PSXPC_TEST
//#include <SYS/TYPES.H>
#include <LIBGTE.H>
#endif

#include "STYPES.H"
#include "SPECIFIC.H"


char AccentTable[46][2] =
{
	{'{', ' '},
	{'u', '^'},
	{'e', '\\'},
	{'a', ']'},
	{'a', '^'},
	{'a', '['},
	{'a', '\\'},
	{'{', ' '},
	{'e', ']'},
	{'e', '^'},
	{'e', '['},
	{'|', '^'},
	{'|', ']'},
	{'|', '['},
	{'A', '^'},
	{'A', ']'},
	{'E', '\\'},
	{' ', ' '},
	{' ', ' '},
	{'o', ']'},
	{'o', '^'},
	{'o', '['},
	{'u', ']'},
	{'u', '['},
	{'y', '^'},
	{'O', '^'},
	{'U', '^'},
	{' ', ' '},
	{'O', '\\'},
	{' ', ' '},
	{' ', ' '},
	{' ', ' '},
	{'a', '\\'},
	{'|', '\\'},
	{'o', '\\'},
	{'u', '\\'},
	{'n', '_'},
	{'N', '_'},
	{' ', ' '},
	{' ', ' '},
	{'}', ' '},
	{' ', ' '},
	{' ', ' '},
	{' ', ' '},
	{' ', ' '},
	{'~', ' '}
};

unsigned char PulseCnt = 0;
unsigned char ScaleFlag;

static CVECTOR ShadeFromTo[10][2] =
{
	{{128, 128, 128, 0}, {128, 128, 128, 0}},
	{{128, 128, 128, 0}, {128, 128, 128, 0}},
	{{128, 128, 128, 0}, {128, 128, 128, 0}},
	{{128, 0, 0, 0}, {64, 0, 0, 0}},
	{{0, 0, 160, 0}, {0, 0, 80, 0}},
	{{128, 128, 128, 0}, {16, 16, 16, 0}},
	{{192, 128, 64, 0}, {64, 16, 0, 0}},
	{{16, 16, 16, 0}, {128, 128, 128, 0}},
	{{224, 192, 0, 0}, {64, 32, 0, 0}},
	{{128, 0, 0, 0}, {64, 0, 0, 0}}
};

#if PC_VERSION
CVECTOR2 FontShades[10][16];

int font_height;
DWORD dword_50A14C = true;


font_thing stru_507AB8[106] =
{
	{ 0.68235302, 0.203922, 4, 13, -11, 0, 11 },
	{ 0.384314, 0.227451, 7, 5, -10, 1, 5 },
	{ 0.321569, 0.101961, 14, 12, -10, 1, 11 },
	{ 0.30588201, 0.14902, 10, 14, -10, 1, 13 },
	{ 0.83921599, 0.050980002, 15, 12, -9, 2, 12 },
	{ 0.156863, 0.101961, 14, 12, -10, 1, 11 },
	{ 0.61960799, 0.223529, 5, 5, -11, 0, 4 },
	{ 0.80000001, 0.152941, 6, 16, -12, 0, 13 },
	{ 0.133333, 0.156863, 6, 16, -11, 0, 14 },
	{ 0.721569, 0.231373, 5, 5, -11, 0, 4 },
	{ 0.086274996, 0.156863, 11, 11, -9, 2, 11 },
	{ 0.698039, 0.231373, 5, 5, -2, 8, 12 },
	{ 0.41568601, 0.235294, 8, 3, -4, 6, 9 },
	{ 0.44705901, 0.235294, 5, 4, -2, 8, 11 },
	{ 0.83137298, 0.14902, 9, 15, -12, 0, 12 },
	{ 0.34509799, 0.192157, 10, 10, -8, 3, 11 },
	{ 0.78431398, 0.21568599, 6, 10, -8, 3, 11 },
	{ 0.180392, 0.203922, 9, 10, -8, 3, 11 },
	{ 0.34509799, 0.14902, 8, 11, -8, 3, 12 },
	{ 0.243137, 0.156863, 11, 11, -8, 3, 12 },
	{ 0.55686301, 0.188235, 9, 12, -9, 2, 12 },
	{ 0.90980399, 0.196078, 9, 11, -9, 2, 11 },
	{ 0.470588, 0.184314, 9, 12, -9, 2, 12 },
	{ 0.086274996, 0.2, 9, 11, -9, 2, 11 },
	{ 0.431373, 0.192157, 9, 11, -8, 3, 12 },
	{ 0.59607798, 0.223529, 5, 9, -7, 4, 11 },
	{ 0.533333, 0.223529, 5, 10, -7, 4, 12 },
	{ 0.698039, 0.156863, 12, 10, -8, 3, 11 },
	{ 0.82352901, 0.20784301, 11, 7, -7, 4, 9 },
	{ 0.941176, 0.156863, 12, 10, -8, 3, 11 },
	{ 0.047059, 0.152941, 10, 13, -11, 0, 11 },
	{ 0.25882399, 0.050980002, 16, 14, -10, 1, 13 },
	{ 0.50980401, 0.050980002, 14, 13, -11, 0, 11 },
	{ 0.83921599, 0.098039001, 13, 13, -11, 0, 11 },
	{ 0.51764703, 0.137255, 11, 13, -11, 0, 11 },
	{ 0.0, 0.101961, 13, 13, -11, 0, 11 },
	{ 0.054901998, 0.101961, 13, 13, -11, 0, 11 },
	{ 0.25882399, 0.105882, 12, 13, -11, 0, 11 },
	{ 0.71372497, 0.105882, 12, 13, -11, 0, 11 },
	{ 0.78431398, 0.050980002, 14, 13, -11, 0, 11 },
	{ 0.870588, 0.21176501, 5, 13, -11, 0, 11 },
	{ 0.21960799, 0.203922, 5, 16, -11, 0, 14 },
	{ 0.90196103, 0.058823999, 13, 13, -11, 0, 11 },
	{ 0.56470603, 0.137255, 11, 13, -11, 0, 11 },
	{ 0.188235, 0.050980002, 18, 13, -11, 0, 11 },
	{ 0.56470603, 0.050980002, 14, 13, -11, 0, 11 },
	{ 0.21176501, 0.101961, 12, 13, -11, 0, 11 },
	{ 0.78431398, 0.101961, 12, 13, -11, 0, 11 },
	{ 0.941176, 0.0, 14, 15, -11, 0, 13 },
	{ 0.61960799, 0.050980002, 14, 13, -11, 0, 11 },
	{ 0.61176503, 0.137255, 11, 13, -11, 0, 11 },
	{ 0.67451, 0.050980002, 14, 13, -11, 0, 11 },
	{ 0.384314, 0.050980002, 15, 13, -11, 0, 11 },
	{ 0.321569, 0.050980002, 15, 13, -11, 0, 11 },
	{ 0.094117999, 0.050980002, 23, 13, -11, 0, 11 },
	{ 0.72941202, 0.050980002, 13, 14, -11, 0, 12 },
	{ 0.44705901, 0.050980002, 15, 13, -11, 0, 11 },
	{ 0.89411801, 0.109804, 12, 13, -11, 0, 11 },
	{ 0.243137, 0.235294, 6, 4, -4, 6, 9 },
	{ 0.97254902, 0.231373, 6, 4, -4, 6, 9 },
	{ 0.34509799, 0.231373, 8, 4, -4, 6, 9 },
	{ 0.55686301, 0.235294, 7, 3, -3, 7, 9 },
	{ 0.470588, 0.231373, 8, 4, -4, 6, 9 },
	{ 0.94902003, 0.231373, 5, 5, -11, 0, 4 },
	{ 0.384314, 0.192157, 11, 9, -7, 4, 11 },
	{ 0.37647101, 0.137255, 11, 14, -12, 0, 11 },
	{ 0.28235301, 0.203922, 9, 9, -7, 4, 11 },
	{ 0.0, 0.152941, 11, 12, -10, 1, 11 },
	{ 0.64313698, 0.203922, 9, 9, -7, 4, 11 },
	{ 0.65882403, 0.14902, 10, 14, -12, 0, 11 },
	{ 0.470588, 0.137255, 12, 12, -7, 4, 14 },
	{ 0.423529, 0.137255, 11, 14, -12, 0, 11 },
	{ 0.76078397, 0.105882, 6, 12, -10, 1, 11 },
	{ 0.156863, 0.2, 6, 16, -10, 1, 14 },
	{ 0.109804, 0.101961, 12, 14, -12, 0, 11 },
	{ 0.321569, 0.203922, 6, 13, -11, 0, 11 },
	{ 0.37647101, 0.101961, 18, 9, -7, 4, 11 },
	{ 0.59607798, 0.188235, 12, 9, -7, 4, 11 },
	{ 0.243137, 0.2, 10, 9, -7, 4, 11 },
	{ 0.95686299, 0.058823999, 11, 13, -7, 4, 14 },
	{ 0.203922, 0.152941, 10, 13, -7, 4, 14 },
	{ 0.039216001, 0.203922, 10, 9, -7, 4, 11 },
	{ 0.74509799, 0.203922, 9, 9, -7, 4, 11 },
	{ 0.0, 0.2, 9, 11, -9, 2, 11 },
	{ 0.698039, 0.196078, 11, 9, -7, 4, 11 },
	{ 0.50980401, 0.188235, 12, 9, -7, 4, 11 },
	{ 0.51764703, 0.101961, 18, 9, -7, 4, 11 },
	{ 0.94902003, 0.196078, 11, 9, -7, 4, 11 },
	{ 0.156863, 0.14902, 11, 13, -7, 4, 14 },
	{ 0.90980399, 0.16078401, 8, 9, -7, 4, 11 },
	{ 0.870588, 0.16078401, 9, 13, -7, 4, 14 },
	{ 0.50980401, 0.223529, 6, 9, -7, 4, 11 },
	{ 0.76078397, 0.152941, 10, 13, -10, 1, 12 },
	{ 0.12548999, 0.21960799, 5, 12, -10, 1, 11 },
	{ 0.0, 0.050980002, 24, 13, -10, 6, 11 },
	{ 0.75294101, 0.0, 24, 13, -10, 6, 11 },
	{ 0.65882403, 0.0, 24, 13, -10, 6, 11 },
	{ 0.84705901, 0.0, 24, 13, -10, 6, 11 },
	{ 0.58823502, 0.101961, 18, 9, -8, 6, 11 },
	{ 0.65882403, 0.101961, 13, 12, -9, 6, 11 },
	{ 0.44705901, 0.101961, 18, 9, -8, 6, 11 },
	{ 0.941176, 0.109804, 13, 12, -9, 6, 11 },
	{ 0.0, 0.0, 41, 13, -10, 6, 11 },
	{ 0.32941201, 0.0, 41, 13, -10, 6, 11 },
	{ 0.16470601, 0.0, 41, 13, -10, 6, 11 },
	{ 0.49411801, 0.0, 41, 13, -10, 6, 11 },
};
font_thing stru_E4DEC0[106];
DWORD dword_E4DC40;
DWORD dword_E4DC44;
DWORD dword_E4DEA4;
#else
CVECTOR FontShades[10][16];
#endif

void InitFont()//115EC(<), 1169C(<) (F) (D) (ND)
{
#if PC_VERSION
	Log(LT_Enter, "InitFont");
#endif
	
	int i;
	int j;

	unsigned char nr;
	unsigned char ng;
	unsigned char nb;

	unsigned char fr;
	unsigned char fg;
	unsigned char fb;

	unsigned short r;
	unsigned short g;
	unsigned short b;

	//loc_11634
	for(i = 0; i < 10; i++)
	{
		fr = ShadeFromTo[i][1].r;
		fg = ShadeFromTo[i][1].g;
		fb = ShadeFromTo[i][1].b;

		nr = ShadeFromTo[i][0].r;
		ng = ShadeFromTo[i][0].g;
		nb = ShadeFromTo[i][0].b;

		//loc_116A0
		for (j = 0; j < 16; j++)
		{
			r = (((nr << 4) + (-nr * j)) >> 4) + ((fr * j) >> 4);
			g = (((ng << 4) + (-ng * j)) >> 4) + ((fg * j) >> 4);
			b = (((nb << 4) + (-nb * j)) >> 4) + ((fb * j) >> 4);

			if (r > 255)
			{
				r = 255;
			}
			//loc_116DC
			if (g > 255)
			{
				g = 255;
			}
			//loc_116EC
			if (b > 255)
			{
				b = 255;
			}
#if PC_VERSION
			uint32_t c1, c2;
			CalcColorSplit(RGB_MAKE(r, g, b), &c1, &c2);

			c1 |= 0xFF000000;
			c2 |= 0xFF000000;
			
			FontShades[i][j].color.rgbcd = c1;
			FontShades[i][j].specular.rgbcd = c2;
#else
			//loc_116F8
			FontShades[i][j].r = r;
			FontShades[i][j].g = g;
			FontShades[i][j].b = b;
#endif
		}
	}

#if PC_VERSION
	if (dword_50A14C)
	{
		for (int i = 0; i < 106; i++)
		{
			stru_E4DEC0[i].a5 = stru_507AB8[i].a5;
			stru_E4DEC0[i].a6 = stru_507AB8[i].a6;
			stru_E4DEC0[i].a7 = stru_507AB8[i].a7;
		}

		dword_50A14C = false;
	}

	for (int i = 0; i < 106; i++)
	{
		stru_507AB8[i].a5 = stru_E4DEC0[i].a5 * phd_winxmax / 512.0;
		stru_507AB8[i].a6 = stru_E4DEC0[i].a6 * phd_winymax / 240.0;
		stru_507AB8[i].a7 = stru_E4DEC0[i].a7 * phd_winymax / 240.0;
	}
	
	font_height = phd_winymax * 7.0 / 120.0;
	dword_E4DC40 = phd_winymax * 7.0 / 120.0;
	dword_E4DEA4 = 6;
#endif

	return;
}
